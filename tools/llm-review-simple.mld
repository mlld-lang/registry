---
description: Simplified LLM review using proper module patterns
author: mlld-registry
version: 1.0.0
---

# Import environment variables
@import { PR_NUMBER, REPO_OWNER, REPO_NAME, PR_TITLE, PR_AUTHOR, ANTHROPIC_API_KEY } from @input

# Import HTTP module (when available)
# @import { http_post } from @mlld/http

# For now, define our own simple HTTP POST
@exec http_post_json(url, api_key, json_file) = @run [
  curl -s @url \
    -H "Content-Type: application/json" \
    -H "x-api-key: @api_key" \
    -H "anthropic-version: 2023-06-01" \
    -d "@@@json_file" | jq -r '.content[0].text // .error.message // "No response"'
]

# Create the review prompt
@text review_prompt = [[
You are reviewing PR #{{PR_NUMBER}} "{{PR_TITLE}}" by @{{PR_AUTHOR}}.

This adds a module to the mlld PUBLIC registry. Please review and respond with:
APPROVE, REQUEST_CHANGES, or COMMENT

Then explain your reasoning.
]]

# Write the API request to a file (avoiding all escaping issues)
@path request_file = "/tmp/claude_request.json"
@run [jq -n --arg prompt "@review_prompt" '{
  model: "claude-3-5-sonnet-20241022",
  max_tokens: 1500,
  system: "You are a helpful code reviewer for an open source module registry.",
  messages: [{role: "user", content: $prompt}]
}' > @request_file]

# Make the API call
@run @http_post_json("https://api.anthropic.com/v1/messages", @ANTHROPIC_API_KEY, @request_file)

# Clean up
@run [rm -f @request_file]