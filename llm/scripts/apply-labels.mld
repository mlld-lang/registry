---
description: Apply GitHub labels based on LLM review results
mlld-version: ">=1.3.0"
---

# Apply Review Labels

@import { * } from @input

## Set Default Values

@text recommendation = @LLM_RECOMMENDATION || "COMMENT"
@text category = @LLM_CATEGORY || "uncategorized"
@text repo = @REPO_OWNER + "/" + @REPO_NAME

## Create Missing Labels if Needed

@exec createLabel(name, color, description) = @run [(
  gh label create "@name" \
    --repo @repo \
    --color "@color" \
    --description "@description"
)]

>> Ensure labels exist
@run @createLabel("llm-approved", "0e8a16", "Module approved by LLM review")
@run @createLabel("needs-changes", "d93f0b", "Changes requested by LLM review")
@run @createLabel("needs-review", "fbca04", "Needs manual review")

## Apply Recommendation Label

@when @recommendation: [
  "APPROVE" => @run [(gh pr edit @PR_NUMBER --repo @repo --add-label "llm-approved")]
  "REQUEST_CHANGES" => @run [(gh pr edit @PR_NUMBER --repo @repo --add-label "needs-changes")]
  "COMMENT" => @run [(gh pr edit @PR_NUMBER --repo @repo --add-label "needs-review")]
]

## Apply Category Label

@when @category: [
  "uncategorized" => @output "No category label to apply" to stdout
  true => @run @createLabel("module-@category", "1d76db", "Module category: @category")
  true => @run [(gh pr edit @PR_NUMBER --repo @repo --add-label "module-@category")]
]

## Summary

@text summaryMessage = [[âœ… Labels applied for PR #{{PR_NUMBER}}: {{recommendation}} ({{category}})]]
@add @summaryMessage